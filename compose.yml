services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:80" 
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      - VITE_API_BASE_URL=http://localhost:8080/api
    networks:
      - app-network

  frontend-dev:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    ports:
      - "5173:5173"  # Webpack dev server poort
    volumes:
      - ./frontend:/app  # Live reload
      - /app/node_modules
    networks:
      - app-network
    environment:
      - WDS_SOCKET_HOST=0.0.0.0

  capacitor-android:
    build:
      context: ./frontend
      dockerfile: Dockerfile.capacitor
    volumes:
      - ./frontend:/app
      - /app/node_modules
      - android-data:/app/android
    working_dir: /app
    command: tail -f /dev/null  # Houd container running
    networks:
      - app-network

  capacitor-ios:
    build:
      context: ./frontend
      dockerfile: Dockerfile.capacitor  
    volumes:
      - ./frontend:/app
      - /app/node_modules
      - ios-data:/app/ios
    working_dir: /app
    command: tail -f /dev/null
    networks:
      - app-network    

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    volumes:
      - ./backend/laravel:/var/www
    environment:
      - DB_HOST=db
      - DB_DATABASE=laravel
      - DB_USERNAME=jonas
      - DB_PASSWORD=geheim
    expose:
      - "9000"
    depends_on:
      - db
    networks:
      - app-network

  backendlogin:
    build:
      context: ./backendlogin
      dockerfile: Dockerfile
    volumes:
      - ./backendlogin/laravel:/var/www
    environment:
      - DB_HOST=dblogin
      - DB_DATABASE=laravel_login
      - DB_USERNAME=jonas
      - DB_PASSWORD=geheim
    expose:
      - "9000"
    depends_on:
      - dblogin
    networks:
      - app-network    

  nginx:
    image: nginx:alpine
    ports:
      - "8080:80"
    volumes:
      - ./backend/laravel:/var/www
      - ./backend/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend
    networks:
      - app-network

  nginxlogin:
    image: nginx:alpine
    ports:
      - "8090:80"
    volumes:
      - ./backendlogin/laravel:/var/www
      - ./backendlogin/default.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backendlogin
    networks:
      - app-network

  db:
    image: mysql:8
    restart: always
    environment:
      MYSQL_DATABASE: laravel
      MYSQL_USER: jonas
      MYSQL_PASSWORD: geheim
      MYSQL_ROOT_PASSWORD: rootgeheim
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - app-network

  dblogin:
    image: mysql:8
    restart: always
    environment:
      MYSQL_DATABASE: laravel_login
      MYSQL_USER: jonas
      MYSQL_PASSWORD: geheim
      MYSQL_ROOT_PASSWORD: rootgeheim
    volumes:
      - mysql-login-data:/var/lib/mysql
    networks:
      - app-network

  phpmyadmin:
    image: phpmyadmin
    restart: always
    ports:
      - "8081:80"
    environment:
      - PMA_ARBITRARY=1
      - PMA_HOSTS=db,dblogin
      - PMA_VERBOSES="Hoofd Database,Login Database"
      - PMA_USER=jonas
      - PMA_PASSWORD=geheim
    depends_on:
      - db
      - dblogin
    networks:
      - app-network

volumes:
  mysql-data:
  mysql-login-data:
  android-data:
  ios-data:

networks:
  app-network:
    driver: bridge